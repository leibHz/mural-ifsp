{% extends "base.html" %}

{% block title %}Mural IFSP - Início{% endblock %}

{% block content %}
<div class="container">
    <!-- Hero Section -->
    <section class="hero-section" style="padding: 3rem 0;">
        <div class="hero-content text-center" data-aos="fade-up">
            <h1 class="hero-title" style="font-size: 2.5rem; font-weight: 800; margin-bottom: 1rem;">
                <span class="text-gradient">Bem-vindo ao Mural IFSP</span>
            </h1>
            <p class="hero-subtitle" style="font-size: 1.2rem; color: var(--texto-secundario); margin-bottom: 2rem;">
                Compartilhe, denuncie e conecte-se com a comunidade do IFSP Bragança Paulista
            </p>
            
            <!-- Botões de Ação -->
            <div class="hero-actions" style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                <button class="btn btn-primary btn-lg" onclick="abrirModalNovaPostagem()" id="btnNovaPostagem">
                    <i class="fas fa-plus"></i> Nova Postagem
                </button>
                <button class="btn btn-outline btn-lg" onclick="window.location.href='/login'" id="btnLogin">
                    <i class="fas fa-sign-in-alt"></i> Entrar
                </button>
            </div>
        </div>
    </section>

    <!-- Filtros e Ordenação -->
    <section class="filters-section" style="margin: 2rem 0;">
        <div class="filters-container" style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
            <div class="filter-group">
                <label style="color: var(--texto-secundario); font-size: 0.9rem; margin-right: 0.5rem;">
                    <i class="fas fa-filter"></i> Tipo:
                </label>
                <select class="form-select" id="filtroTipo" style="width: 150px;">
                    <option value="">Todos</option>
                    <option value="imagem">Imagens</option>
                    <option value="video">Vídeos</option>
                    <option value="audio">Áudios</option>
                    <option value="pdf">PDFs</option>
                    <option value="texto">Textos</option>
                </select>
            </div>

            <div class="filter-group">
                <label style="color: var(--texto-secundario); font-size: 0.9rem; margin-right: 0.5rem;">
                    <i class="fas fa-sort"></i> Ordenar:
                </label>
                <select class="form-select" id="ordenacao" style="width: 150px;">
                    <option value="recentes">Mais recentes</option>
                    <option value="visualizacoes">Mais visualizadas</option>
                    <option value="comentarios">Mais comentadas</option>
                </select>
            </div>
        </div>
    </section>

    <!-- Grid de Postagens -->
    <section class="posts-section">
        <div id="postagensGrid" class="posts-grid">
            <!-- Postagens serão carregadas aqui via JavaScript -->
            
            <!-- Loading Skeleton -->
            <div class="loading-skeleton">
                <div class="post-card skeleton">
                    <div class="skeleton-avatar" style="margin: 1rem;"></div>
                    <div class="skeleton-title" style="margin: 0 1rem;"></div>
                    <div class="skeleton-card" style="margin: 1rem 0;"></div>
                    <div class="skeleton-text" style="margin: 0 1rem 1rem;"></div>
                </div>
            </div>
        </div>

        <!-- Paginação -->
        <div class="pagination-container" id="paginacao" style="display: flex; justify-content: center; gap: 0.5rem; margin-top: 2rem;">
            <!-- Paginação será carregada aqui -->
        </div>

        <!-- Mensagem de vazio -->
        <div id="mensagemVazio" style="display: none; text-align: center; padding: 3rem;">
            <i class="fas fa-inbox" style="font-size: 4rem; color: var(--texto-terciario); margin-bottom: 1rem;"></i>
            <p style="color: var(--texto-secundario); font-size: 1.2rem;">Nenhuma postagem encontrada</p>
        </div>
    </section>
</div>

<!-- Modal de Nova Postagem -->
<div class="modal-overlay" id="modalNovaPostagem">
    <div class="modal" style="max-width: 600px;">
        <div class="modal-header">
            <h2 class="modal-title">Nova Postagem</h2>
            <button class="modal-close" onclick="fecharModalNovaPostagem()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <form id="formNovaPostagem" class="modal-body">
            <div class="form-group">
                <label class="form-label">
                    <i class="fas fa-image"></i> Tipo de Mídia
                </label>
                <select class="form-select" id="tipoMidia" required>
                    <option value="">Selecione o tipo</option>
                    <option value="imagem">Imagem</option>
                    <option value="video">Vídeo</option>
                    <option value="audio">Áudio</option>
                    <option value="pdf">PDF</option>
                    <option value="gif">GIF</option>
                    <option value="texto">Apenas Texto</option>
                </select>
            </div>

            <div class="form-group" id="uploadContainer" style="display: none;">
                <label class="form-label">
                    <i class="fas fa-upload"></i> Arquivo
                </label>
                <div class="upload-area" id="uploadArea" style="border: 2px dashed var(--borda); border-radius: var(--radius-md); padding: 2rem; text-align: center; cursor: pointer; transition: all 0.3s;">
                    <i class="fas fa-cloud-upload-alt" style="font-size: 3rem; color: var(--texto-terciario); margin-bottom: 1rem;"></i>
                    <p style="color: var(--texto-secundario); margin-bottom: 0.5rem;">Clique ou arraste o arquivo aqui</p>
                    <p style="color: var(--texto-terciario); font-size: 0.85rem;" id="formatosPermitidos"></p>
                    <input type="file" id="arquivoUpload" style="display: none;" accept="">
                </div>
                <div id="previewContainer" style="margin-top: 1rem; display: none;"></div>
            </div>

            <div class="form-group">
                <label class="form-label">
                    <i class="fas fa-align-left"></i> Descrição <span style="color: var(--vermelho-alerta);">*</span>
                </label>
                <textarea class="form-textarea" id="descricao" placeholder="Descreva sua postagem (mínimo 10 caracteres)..." required minlength="10" maxlength="5000"></textarea>
                <p class="form-help">
                    <span id="contadorCaracteres">0</span> / 5000 caracteres
                </p>
            </div>

            <div class="form-group" id="transcricaoContainer" style="display: none;">
                <label class="form-label">
                    <i class="fas fa-closed-captioning"></i> Transcrever áudio?
                </label>
                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                    <input type="checkbox" id="transcricaoAudio">
                    <span>Sim, gerar transcrição automática para acessibilidade</span>
                </label>
            </div>
        </form>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" onclick="fecharModalNovaPostagem()">
                Cancelar
            </button>
            <button type="submit" form="formNovaPostagem" class="btn btn-primary">
                <i class="fas fa-paper-plane"></i> Publicar
            </button>
        </div>
    </div>
</div>

<!-- Modal de Visualização de Postagem -->
<div class="modal-overlay" id="modalVisualizarPostagem">
    <div class="modal" style="max-width: 900px;">
        <div class="modal-header">
            <h2 class="modal-title">Postagem</h2>
            <button class="modal-close" onclick="fecharModalVisualizacao()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body" id="conteudoPostagem" style="padding: 0;">
            <!-- Conteúdo da postagem será carregado aqui -->
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/postagens.js') }}"></script>
<script src="{{ url_for('static', filename='js/comentarios.js') }}"></script>
<script>
    // Configuração específica da página inicial
    document.addEventListener('DOMContentLoaded', () => {
        carregarPostagens();
        
        // Configurar filtros
        document.getElementById('filtroTipo')?.addEventListener('change', () => {
            carregarPostagens();
        });
        
        document.getElementById('ordenacao')?.addEventListener('change', () => {
            carregarPostagens();
        });
        
        // Atualizar botões baseado em autenticação
        atualizarBotoesAuth();
    });

    async function atualizarBotoesAuth() {
        const autenticado = await window.muralIFSP.verificarAutenticacao();
        const btnNovaPostagem = document.getElementById('btnNovaPostagem');
        const btnLogin = document.getElementById('btnLogin');
        
        if (autenticado) {
            const user = window.muralIFSP.currentUser();
            
            if (user && user.tipo_usuario === 'estudante') {
                btnNovaPostagem.style.display = 'inline-flex';
                btnLogin.style.display = 'none';
            } else {
                btnNovaPostagem.style.display = 'none';
                btnLogin.textContent = 'Perfil';
                btnLogin.onclick = () => window.location.href = '/perfil';
            }
        } else {
            btnNovaPostagem.style.display = 'none';
            btnLogin.style.display = 'inline-flex';
        }
    }
</script>
{% endblock %}